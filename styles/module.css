/* =========================================================
   1. 視窗主體架構 (Main Layout)
   設定聊天視窗的整體背景、排版方式
   ========================================================= */

.YCIO-floating-chat-window {
    /* --- 定義 CSS 變數預設值 --- */
    --YCIO-bg: rgba(0, 0, 0, 0.8);

    display: flex;
    flex-direction: column;
    /* 垂直排列：分頁 -> 內容 -> 輸入框 */
    background: var(--YCIO-bg);
    /* 視窗背景色 (預設半透明黑) */
    color: white;
    /* 預設文字顏色 */
    padding: 0;
}

.YCIO-floating-chat-window .window-content {
    padding: 2px;
}

#YCIO-floating-chat-window>menu {
    background-image: none;
    background: rgba(0, 0, 0, 1);
}

/* =========================================================
   2. 分頁標籤 (Tabs)
   頂部的分頁切換區塊
   ========================================================= */

.YCIO-floating-chat-window .tabs {
    display: flex;
    border-bottom: 1px solid #555;
    padding: 0px 2px;

    /* 支援水平捲動 */
    overflow-x: auto;
    white-space: nowrap;
    justify-content: flex-start;
    gap: 2px;

    /* 隱藏醜醜的捲動條 (Webkit 瀏覽器) */
    scrollbar-width: thin;
    scrollbar-color: #444 transparent;
}

.YCIO-floating-chat-window .tabs::-webkit-scrollbar {
    height: 2px;
}

.YCIO-floating-chat-window .tabs::-webkit-scrollbar-thumb {
    background-color: #444;
    border-radius: 2px;
}

.YCIO-floating-chat-window .tabs .item {
    padding: 0px 5px;
    font-size: 1em;
    /* 字體 */
    cursor: pointer;
    color: #aaa;
    transition: color 0.2s, background 0.2s;
    white-space: nowrap;
    /* 確保文字不換行 */
    border-radius: 4px;
    /* 增加圓角 */
    border-right: 1px solid #555;
}

.YCIO-floating-chat-window .tabs .item:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.05);
}

.YCIO-floating-chat-window .tabs .item.active {
    background: #444;
    border-radius: 4px;
    color: #fff;
    font-weight: bold;
    border-right: 2px outset #EE3;
}

/* =========================================================
   3. 聊天內容區域 (Chat Content Area)
   顯示訊息列表的主要區塊
   ========================================================= */

.YCIO-floating-chat-window .chat-content {
    flex: 1;
    /* 佔滿中間剩餘空間 */
    display: flex;
    flex-direction: column;
    min-height: 0;
    /* 關鍵：防止內容撐開父元素，確保 flex 正確運作 */
    overflow: hidden;
    /* 隱藏溢出，讓捲動發生在內部的 #custom-chat-log */
    padding: 0px;
    position: relative;
    /* 讓內部的絕對定位元素 (如置底按鈕) 以此為基準 */
}

/* 訊息列表容器 (ul/ol) */
.YCIO-floating-chat-window .chat-log {
    flex: 1;
    overflow-y: auto;
    /* 必須要有 auto，捲動條才會出現 */
    height: 100%;
    /* 確保高度被撐滿 */
    list-style: none;
    /* 移除列表的點點 */
    padding: 0px;
    margin: 0;
    overflow-anchor: auto;
}

/* 載入中的讀取條 (撈取舊訊息時顯示) */
.YCIO-floating-chat-window .loading-spinner {
    text-align: center;
    font-size: 10px;
    color: #888;
    padding: 4px;
    display: none;
    /* 預設隱藏，由 JS 控制顯示 */
}

/* =========================================================
   4. 訊息樣式 (Message Bubbles)
   單條訊息的外觀、卡牌、圖片與特殊狀態
   ========================================================= */

/* 訊息外框基礎樣式 */
.YCIO-floating-chat-window .chat-message {
    background: rgb(255, 255, 255);
    /* 預設白底 */
    border: 1px solid #444;
    border-radius: 4px;
    /* margin-bottom 可以視需要加入，保持訊息間距 */

    display: flex;
    flex-direction: row;
    /* 水平排列 */
    align-items: flex-start;
    /* 頂部對齊 */
    gap: 4px;
    /* 頭像與內容的間距 */
    padding: 2px;
    /* 整體內縮一點 */

    /* 確保原本的背景色/邊框還是在最外層 */
    background: rgb(255, 255, 255);
    border: 1.5px solid #444;
    border-radius: 4px;

}

/* 訊息標頭 (發訊者、時間等) */
.YCIO-floating-chat-window .chat-message .message-body .message-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    /* 讓分隔線淡一點 */
    margin-bottom: 4px;
}

.YCIO-floating-chat-window .chat-message .message-body .message-header * {
    font-size: 0.7rem;
    /*字體大小*/
    color: #000;
    /*內部字的顏色*/

    /*以下是文字馬賽克樣式*/
    /*color: transparent;
    text-shadow: 0 0 10px rgba(0, 0, 0, 0.9);    
    filter: blur(2px);*/
}




/* --- 圖片與卡牌處理 --- */

/* 讓訊息內的圖片不要超出邊框 (RWD) */
.YCIO-floating-chat-window .chat-message img {
    max-width: 100%;
    height: auto;
}

/* 卡牌與物件的佈局容器 */
.YCIO-floating-chat-window .chat-message .card-draw {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 5px 0;
}

/* 限制卡牌與內容圖片的最大高度，避免洗版 */
.YCIO-floating-chat-window .chat-message .card-draw img,
.YCIO-floating-chat-window .chat-message .message-content img {
    max-height: 48px;
    width: auto;
    object-fit: contain;
    border: none;
}

/* 單純的擲骰圖片或表情符號垂直置中 */
.YCIO-floating-chat-window .chat-message .message-content img {
    vertical-align: top;
}

/* 訊息內顯示的擲骰樣式 */
.YCIO-floating-chat-window .chat-message .message-content .dice-roll {
    min-width: 100px;
}

.YCIO-floating-chat-window .chat-message .message-content .dice-roll .dice-formula {
    padding-left: 4px;
    padding-right: 4px;
}

/* 訊息內容，主要寫用來插入圖片表符等 */
.YCIO-floating-chat-window .chat-message .message-content {
    display: flex;
    align-items: baseline;
}

/* --- 特殊訊息類型 (配色區) --- */

/* 私訊 (Whisper) - 淡紫色 */
.YCIO-floating-chat-window .chat-message.whisper {
    background: rgba(230, 220, 240);
    border-color: #7a5d96;
}

/* 盲骰 (Blind) - 淡紅色 */
.YCIO-floating-chat-window .chat-message.blind {
    background: rgba(240, 220, 220);
    border-color: #965d5d;
}

/* 情感描述/扮演 (Emote / IC) - 灰色斜體 */
.YCIO-floating-chat-window .chat-message.emote {
    background: rgba(210, 210, 210);
    font-style: italic;
}

/* =========================================================
   5. 訊息頭像佈局 (Message Avatar Layout)
   左圖右文
   ========================================================= */

/* 2. 左側頭像區域 */
.YCIO-floating-chat-window .message-avatar {
    flex-shrink: 0;
    /* 防止頭像被壓縮 */
    width: 40px;
    /* 頭像固定寬度 */
    height: 40px;
    /* 頭像固定高度 */
    border-radius: 4px;
    /* 小圓角 */
    overflow: hidden;
    background: #000;
    margin-top: 2px;
    /* 微調對齊 */
    border: 1px solid #666;
}

.YCIO-floating-chat-window .message-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    /* 保持比例填滿 */
    border: none;
    display: block;
}

/* 3. 右側內容區域 (包覆原本的 header 和 content) */
.YCIO-floating-chat-window .message-body {
    flex: 1;
    /* 佔據剩餘空間 */
    min-width: 0;
    /* 關鍵：防止內容(如長網址)撐爆 Flex */
    display: flex;
    flex-direction: column;
    color: #000;
    /* 內部字的顏色 */
}

/* =========================================================
   6. 輸入區域 (Input Area)
   底部的文字輸入框、發送按鈕與打字提示
   ========================================================= */

/* 頭像選擇器按鈕那一塊 */
.YCIO-floating-chat-window .speaker-row {
    display: flex;
    gap: 5px;
    align-items: center;
}

.YCIO-floating-chat-window #chat-avatar-btn {
    width: 30px;
    height: 30px;
    background: #333;
    color: #aaa;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
}

.YCIO-floating-chat-window #chat-avatar-btn.YCIO-disabled {
    opacity: 0.5;
    /* 變半透明 */
    filter: grayscale(100%);
    /* 變灰階 (選用) */
    cursor: not-allowed;
    /* 滑鼠移上去變成紅色禁止符號 */
}

.YCIO-floating-chat-window #chat-wait-btn {
    width: auto;
    /* 自動寬度 */
    height: 30px;
    padding: 0 8px;
    /* 左右內距 */
    background: #333;
    color: #aaa;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    /* Flex 排版 */
    align-items: center;
    /* 垂直置中 */
    justify-content: center;
    gap: 6px;
    /* 圖示與文字的間距 */
    font-size: 0.9em;
    /* 文字大小 */
}

.YCIO-floating-chat-window #chat-avatar-btn:hover,
.YCIO-floating-chat-window #chat-wait-btn:hover {
    color: #fff;
    background: #444;
}

.YCIO-floating-chat-window #chat-wait-btn.YCIO-active {
    /* 這裡只設定基礎樣式，動態變化交給 animation */
    background: #eee;
    color: #000;
    font-weight: bold;
    border-color: #fff;

    /* 設定動畫：名稱 / 持續時間 1.5秒 / 無限循環 / 緩入緩出 */
    animation: YCIO-wait-pulse-anim 1.5s infinite ease-in-out;
}

@keyframes YCIO-wait-pulse-anim {
    0% {
        background-color: #eee;
        color: #000;
        box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        transform: scale(1);
    }

    50% {
        /* 變暗一點，光暈變強 */
        background-color: #ddd;
        color: #222;
        box-shadow: 0 0 15px rgba(255, 215, 0, 1);
        border-color: #ffaa00;
        transform: scale(1.02);
        /* 微微放大 */
    }

    100% {
        background-color: #eee;
        color: #000;
        box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        transform: scale(1);
    }
}

/* 「稍等一下按鈕」文字切換邏輯與動畫 */
/* 預設狀態：顯示 idle，隱藏 active */
.YCIO-floating-chat-window #chat-wait-btn .label-idle {
    display: inline;
}

.YCIO-floating-chat-window #chat-wait-btn .label-active {
    display: none;
}

/* 激活狀態 (.YCIO-active)：隱藏 idle，顯示 active */
.YCIO-floating-chat-window #chat-wait-btn.YCIO-active .label-idle {
    display: none;
}

.YCIO-floating-chat-window #chat-wait-btn.YCIO-active .label-active {
    display: inline;
}

.YCIO-floating-chat-window .YCIO-status-waiting {
    color: #ffd700;
    /* 金色 */
    font-weight: bold;
    /* 粗體 */
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
    /* 增加一點陰影讓文字在深色背景更清楚 */
}

/* 頭像按鈕的 Tooltip，因為不依附在模組的視窗內，必須獨立指定 */
.YCIO-avatar-tooltip {
    transition-delay: 0s !important;
    /* 移除顯示延遲，雖然好像沒卵用 */
}

/* 文字格式按鈕 */
.YCIO-floating-chat-window .chat-input-area .chat-toolbar {
    display: flex;
    position: absolute;
    right: 0;
    align-items: center;
    gap: 5px;
    padding: 2px 5px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px 4px 0 0;
    /* 上方圓角 */
    margin-bottom: 0;
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar button {
    color: var(--color-text-light-highlight);
    cursor: pointer;
    padding: 0px 0px;
    height: 24px;
    width: 24px;
    line-height: 24px;
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar button:hover {
    color: var(--color-text-light-heading);
    text-shadow: 0 0 5px var(--color-shadow-primary);
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar .color-control-group {
    display: flex;
    align-items: center;
    border: 1px solid #474747;
    border-radius: 2px;
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 2px;
    padding-right: 2px;
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar .color-control-group #chat-text-color-picker {
    background: none;
    color: var(--color-text-light-highlight);
    cursor: pointer;
    padding: 4px 0px;
    height: 24px;
    width: 30px;
    line-height: 24px;
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar .color-control-group #chat-text-color-picker::-webkit-color-swatch-wrapper {
    padding: 0;
}

.YCIO-floating-chat-window .chat-input-area .chat-toolbar .color-control-group #chat-text-color-picker::-webkit-color-swatch {
    border: none;
}

/* 聊天輸入框 */
.YCIO-floating-chat-window .chat-input-area {
    padding: 0px;
    padding-top: 2px;
    flex-shrink: 0;
    /* 防止被擠壓，保持高度 */
    display: flex;
    /* flex column 佈局 */
    flex-direction: column;
    gap: 2px;
    /* 元素間距 */
    background: rgba(0, 0, 0, 0.2);
    /* 稍微加深背景，區分輸入區 */
    border-top: 1px solid #444;
    /* 加上頂部邊框，視覺上更整齊 */
}

/* 身份選擇器樣式 */
.YCIO-floating-chat-window .speaker-select-wrapper {
    width: 30%;
}

.YCIO-floating-chat-window #chat-speaker-select {
    /* 使用變數，預設為淺灰 */
    color: var(--user-color, #f5f5f5);
    /* 增加文字陰影，試圖在背景顏色相近下盡量保持可見度 */
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 1), 0 0 5px rgba(0, 0, 0, 0.8);

    width: 100%;
    background: #333;
    border: 2px solid #555;
    border-radius: 4px;
    padding: 4px;
    font-size: 0.9rem;
    font-weight: bold;
    cursor: pointer;
}

.YCIO-floating-chat-window #chat-speaker-select:hover {
    background: #444;
}

/* 定義閃爍動畫：邊框與陰影發光 */
@keyframes YCIO-flash-highlight {
    0% {
        border-color: #555;
        /* 初始狀態：無光暈 */
        box-shadow: 0 0 0 rgba(255, 215, 0, 0);
        background-color: #333;
        transform: scale(1);
    }

    50% {
        border-color: #FFD700;
        /* 亮金色邊框 */
        /* 外部大範圍金色光暈 + 內部金色光暈 */
        box-shadow: 0 0 25px 5px rgba(255, 215, 0, 1), inset 0 0 15px rgba(255, 215, 0, 0.8);
        /* 背景變亮 */
        background-color: #6e6218;
        /* 稍微放大 */
        transform: scale(1.02);
    }

    100% {
        border-color: #555;
        /* 回復狀態：無光暈 */
        box-shadow: 0 0 0 rgba(255, 215, 0, 0);
        background-color: #333;
        transform: scale(1);
    }
}

.YCIO-pulse-animation {
    animation: YCIO-flash-highlight 1.2s ease-in-out;
    position: relative;
    z-index: 10;
}

/* 輸入框包覆層：用於定位發送按鈕 */
.YCIO-floating-chat-window .input-wrapper {
    position: relative;
    width: 100%;
    display: flex;
    align-items: flex-end;
    /* 讓按鈕跟隨輸入框底部對齊 */
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

/* 文字輸入框 (Textarea) */
.YCIO-floating-chat-window textarea {
    width: 100%;
    height: auto;
    /* 自動高度 */
    min-height: 32px;
    /* 最小高度 */
    background: #222;
    /* 輸入框深色背景 */
    color: white;
    border: 1px solid #444;
    border-radius: 4px;

    /* 關鍵行為設定 */
    resize: none;
    /* 禁止手動拉大，由 JS 控制 */
    overflow-y: hidden;
    /* 未達最大高度前隱藏捲軸 */
    padding: 6px 35px 2px 2px;
    /* padding-right: 40px 是為了避開右下角的發送按鈕 */
    line-height: 1.4;
    box-sizing: border-box;
}

/* 發送按鈕 (右下角小飛機/文字) */
.YCIO-floating-chat-window #chat-send-btn {
    position: absolute;
    right: 5px;
    bottom: 5px;

    width: auto;
    height: 30px;
    background: transparent;
    color: #888;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.2s;
}

.YCIO-floating-chat-window #chat-send-btn:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
    /* 滑鼠懸停時的微亮背景 */
    border-radius: 4px;
}

/* 誰在打字提示文字 (Typing Indicator) */
.YCIO-floating-chat-window .typing-indicator {
    font-size: 12px;
    color: #aaa;
    /* 淺灰色字體 */
    font-style: italic;
    height: 12px;
    /* 固定高度，避免文字出現時造成版面跳動 */
    opacity: 0;
    /* (依需求保留) 預設為 1，透過 class 切換或 JS 控制 */
    transition: opacity 0.3s ease;
    /* 淡入淡出效果 */
    pointer-events: none;
    /* 讓滑鼠點不到它，避免擋住下方的操作 */
}

/* 雖然原本設定 opacity:1，但保留這個 class 以便未來 JS 控制顯示狀態 */
.YCIO-floating-chat-window .typing-indicator.active {
    opacity: 1;
}

/* =========================================================
   7. 懸浮按鈕與通知 (Floating Buttons & Notifications)
   跳至底部、新訊息通知橫幅
   ========================================================= */

/* 跳至底部按鈕 (橫幅樣式) */
.YCIO-floating-chat-window .jump-to-bottom {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 35px;
    /* 橫幅高度 */

    background: rgba(40, 40, 40, 0.9);
    /* 深色半透明背景 */
    color: #ffd700;
    /* 金黃色文字，顯眼 */
    border: none;
    border-top: 1px solid #666;
    border-radius: 0;

    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;

    /* 預設隱藏狀態 */
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 100;
    /* 確保蓋在訊息列表上方 */
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
}

.YCIO-floating-chat-window .jump-to-bottom:hover {
    background: rgba(60, 60, 60, 0.95);
    color: #fff;
}

/* 顯示狀態 (由 JS 添加 .visible) */
.YCIO-floating-chat-window .jump-to-bottom.visible {
    opacity: 1;
    visibility: visible;
}

/* 按鈕文字：預設 */
.YCIO-floating-chat-window .jump-to-bottom::after {
    content: "回到底部";
}

/* --- 新訊息通知狀態 (Unread) --- */
/* 當有新訊息時的背景色 (更亮的黃色) */
.YCIO-floating-chat-window .jump-to-bottom.unread {
    background: rgba(242, 255, 105, 0.9);
    color: #000000;
}

/* 當有新訊息時的文字 */
.YCIO-floating-chat-window .jump-to-bottom.unread::after {
    content: "有新訊息";
}

/* =========================================================
   8. 頭像選擇器 (Avatar Selector Popup)
   ========================================================= */

.YCIO-avatar-selector-window .window-content {
    padding: 0;
    background: #222;
}

.YCIO-avatar-selector-window .avatar-selector-container {
    padding: 10px;
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.YCIO-avatar-selector-window .avatar-selector-container .controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 10px;
    border-bottom: 1px solid #444;
}

.YCIO-avatar-selector-window .avatar-selector-container .avatar-grid {
    flex: 1;
    display: grid;
    /* 固定最小寬度為 90px，讓卡片不要太小 */
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    /* 固定行高，讓所有卡片高度一致 (圖片高度 + 詳情區高度) */
    grid-auto-rows: max-content;
    gap: 10px;
    overflow-y: auto;
    /* 確保內容過多時出現捲軸 */
    padding: 5px;
    align-content: start;
    /* 防止 grid items 被拉伸填滿高度 */
}

/* 單個頭像項目 卡片容器 */
.YCIO-avatar-selector-window .avatar-card {
    display: flex;
    flex-direction: column;
    background: #111;
    border: 1px solid #444;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    transition: border-color 0.2s;
    /* 不設固定高度，由內容撐開，但圖片區會保持比例 */
    position: relative;
}

/* 選中狀態 */
.YCIO-avatar-selector-window .avatar-card.selected {
    border: 1px solid #ffd700;
    box-shadow: 0 0 4px #ffd700;
}

/* 圖片區域 */
.YCIO-avatar-selector-window .avatar-card .image-wrapper {
    position: relative;
    width: 100%;
    /* 使用 padding-top 強制創造正方形 (1:1) */
    padding-top: 100%;
    background: #000;
    overflow: hidden;
    /* 確保圖片不溢出 */
}

.YCIO-avatar-selector-window .avatar-card img {
    position: absolute;
    /* 脫離文檔流，避免撐開父元素 */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    /* 保持比例填滿 */
    display: block;
}

/* 刪除按鈕 */
.YCIO-avatar-selector-window .avatar-card .delete-btn {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 20px;
    height: 20px;
    background: rgba(200, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.2s;
    cursor: pointer;
}

.YCIO-avatar-selector-window .avatar-card:hover .delete-btn {
    opacity: 1;
}

/* 底部詳情區 (輸入框) */
.YCIO-avatar-selector-window .avatar-card .details {
    padding: 0px 0px;
    background: #222;
    border-top: 2px solid #333;
    display: flex;
    align-items: center;
    justify-content: center;
    /* 固定高度確保整齊 */
    height: 30px;
    box-sizing: border-box;
}

/* 預設標籤文字 */
.YCIO-avatar-selector-window .avatar-card .system-label {
    font-size: 10px;
    color: #888;
}

/* 註解輸入框 */
.YCIO-avatar-selector-window .avatar-card input.avatar-label-input {
    width: 100%;
    background: transparent;
    border: none;
    border-bottom: 1px solid #444;
    color: #ccc;
    font-size: 11px;
    /* 字稍微大一點點 */
    text-align: center;
    padding: 2px 0;
    height: 100%;
}

.YCIO-avatar-selector-window .avatar-card input.avatar-label-input:focus {
    outline: none;
    border-bottom-color: #ffd700;
    color: white;
}


/* 底部確認區域 */
.YCIO-avatar-selector-window .avatar-selector-container .footer {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #444;
}

/* 確認按鈕樣式 */
.YCIO-avatar-selector-window .avatar-selector-container .confirm-btn {
    width: 100%;
    padding: 8px;
    background: #333;
    color: #eee;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
}

.YCIO-avatar-selector-window .avatar-selector-container .confirm-btn:hover {
    background: #444;
    color: #fff;
    border-color: #666;
}

/* 拖曳中的頭像卡片 (半透明 + 虛線框) */
.YCIO-avatar-selector-window .avatar-card.dragging {
    opacity: 0.4;
    border: 2px dashed #999;
}

/* 拖曳經過目標上方時的樣式 (提示放置位置) */
.YCIO-avatar-selector-window .avatar-card.drag-over {
    border: 2px solid #ffd700;
    /* 金色實線框 */
    transform: scale(1.02);
    /* 微微放大 */
    z-index: 1;
}


/* =========================================================
   9. Inline Avatar Picker 樣式 
   ========================================================= */
.YCIO-inline-picker .inline-avatar-picker-container .picker-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    gap: 2px;
    padding: 2px;
}

.YCIO-inline-picker .inline-avatar-picker-container .picker-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--color-border-light-tertiary);
    border-radius: 4px;
    padding: 4px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.2s;
    height: auto;
    /* 覆寫預設 button 高度 */
}

.YCIO-inline-picker .inline-avatar-picker-container .picker-item:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--color-text-hyperlink);
}

.YCIO-inline-picker .inline-avatar-picker-container .img-wrapper {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 4px;
}

.YCIO-inline-picker .inline-avatar-picker-container img {
    max-width: 100%;
    max-height: 100%;
    border: none;
}

.YCIO-inline-picker .inline-avatar-picker-container .label {
    font-size: 0.8em;
    color: var(--color-text-light-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}

/* =========================================================
   10. 訊息編輯器 (Message Editor)
   ========================================================= */

/* 1. 編輯器主容器 */
/* 兼容 ApplicationV2 視窗結構 (如果視窗沒有套用 YCIO-floating-chat-window class) */

.YCIO-message-editor-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    /* 撐滿父容器 */
    background: rgba(0, 0, 0, 0.4);
    /* 深色背景 */
    padding: 4px;
    /* 整體內縮一點點 */
    gap: 2px;
    /* 設定所有元素之間的緊湊間距 */
    box-sizing: border-box;
}

.YCIO-message-editor .window-content {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: rgba(0, 0, 0, 0.2);
    /* 與原版輸入區一致的深色背景 */
    padding: 2px;
    overflow: hidden;
    gap: 0px;
    box-sizing: border-box;
}

/* 2. 工具列 (Toolbar) */
/* 強制覆寫原本 absolute 定位，改為 flex 佈局的一部份 */
.YCIO-message-editor-container .chat-toolbar {
    position: relative;
    /* 不再是 absolute */
    right: auto;
    bottom: auto;
    flex: 0 0 auto;
    display: flex;
    justify-content: flex-end;
    /* 靠右對齊 */
    background: transparent;
    /* 移除背景色，因為編輯器背景已經夠深了 */
    gap: 5px;
    padding: 2px 5px;
    margin-bottom: 0px;
    border: none;
}

/* 確保按鈕樣式與主視窗一致 */
.YCIO-message-editor-container .chat-toolbar button {
    color: var(--color-text-light-highlight);
    cursor: pointer;
    padding: 0px 0px;
    height: 24px;
    width: 24px;
    line-height: 24px;
}

.YCIO-message-editor-container .chat-toolbar button:hover {
    color: var(--color-text-light-heading);
    text-shadow: 0 0 5px var(--color-shadow-primary);
}

.YCIO-message-editor-container .chat-toolbar button:hover .color-control-group {
    display: flex;
    align-items: center;
    border: 1px solid #474747;
    border-radius: 2px;
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 2px;
    padding-right: 2px;
}

.YCIO-message-editor-container .chat-toolbar .color-control-group #chat-text-color-picker {
    background: none;
    color: var(--color-text-light-highlight);
    cursor: pointer;
    padding: 4px 0px;
    height: 24px;
    width: 30px;
    line-height: 24px;
}

.YCIO-message-editor-container .chat-toolbar .color-control-group #chat-text-color-picker::-webkit-color-swatch-wrapper {
    padding: 0;
}

.YCIO-message-editor-container .chat-toolbar .color-control-group #chat-text-color-picker::-webkit-color-swatch {
    border: none;
}

/* 3. 輸入框區域 (Input Wrapper) */
.YCIO-message-editor-container .input-wrapper {
    flex: 1;
    /* 佔滿剩餘高度 */
    display: flex;
    flex-direction: column;
    min-height: 0;
    border-radius: 4px;
    overflow: hidden;
    /* 防止圓角破圖 */
}

/* 文字輸入框本體 */
.YCIO-message-editor-container textarea.YCIO-chat-entry {
    flex: 1;
    /* 撐滿 input-wrapper */
    width: 100%;
    height: 100%;
    min-height: 120px;
    /* 給予足夠的編輯空間 */
    resize: none;
    /* 禁止手動拉伸，由視窗大小控制 */
    border: none;
    background: #222;
    color: #eee;
    padding: 4px;
    font-size: 14px;
    /* 字體稍微大一點，易於編輯 */
    line-height: 1.5;
    box-sizing: border-box;
    outline: none;
}

.YCIO-message-editor-container textarea.YCIO-chat-entry:focus {
    border-color: #777;
    background: #1a1a1a;
}

/* 4. 底部按鈕區 (Form Footer) */
.YCIO-message-editor-container .form-footer {
    display: flex;
    gap: 4px;
    margin-top: 2px;
    padding-top: 2px;
    border-top: 1px solid #444;
    /* 分隔線 */
}

/* 通用按鈕樣式 */
.YCIO-message-editor-container .form-footer button {
    height: 32px;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all 0.2s;
}

/* 取消按鈕 (左邊，灰色系) */
.YCIO-message-editor-container .form-footer button[data-action="cancel"] {
    background: #333;
    color: #aaa;
}

.YCIO-message-editor-container .form-footer button[data-action="cancel"]:hover {
    background: #444;
    color: #fff;
    border-color: #666;
}

/* 更新按鈕 (右邊，強調色 - 類似原本的發送按鈕) */
.YCIO-message-editor-container .form-footer button[data-action="updateMessage"] {
    background: #2d4f2d;
    /* 深綠色底，代表確認 */
    color: #dfd;
    border-color: #4a7a4a;
}

.YCIO-message-editor-container .form-footer button[data-action="updateMessage"]:hover {
    background: #3a633a;
    color: #fff;
    border-color: #5c9c5c;
    box-shadow: 0 0 5px rgba(0, 255, 0, 0.2);
}

/* =========================================================
   11. 聊天紀錄導出視窗 (Export Dialog)
   ========================================================= */

/* 1. 主容器：Flex 佈局，撐滿視窗高度 */
.YCIO-export-form {
    display: flex;
    flex-direction: column;
    height: 100%;
    /* 撐滿 ApplicationV2 的視窗內容區 */
    gap: 5px;
    /* 區塊間距 */
    overflow: hidden;
    /* 防止外部捲軸 */
}

.YCIO-export-form .notes {
    margin: 0 0 5px 0;
    color: #ccc;
    font-size: 0.9em;
    flex-shrink: 0;
    /* 防止說明文字被擠壓 */
}

/* 2. 分頁選單列表：Grid 佈局，自動填滿剩餘空間 */
.YCIO-export-form .export-tab-list {
    flex: 1;
    /* 自動長高填滿剩餘空間 */
    min-height: 0;
    /* 防止 Flex 子元素溢出 */
    overflow-y: auto;
    /* 內容過多時內部捲動 */

    background: rgba(0, 0, 0, 0.2);
    padding: 4px;
    border: 1px solid #444;
    border-radius: 4px;

    /* Grid 設定：自動排列，每格最小 80px，最大平分 */
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    grid-auto-rows: max-content;
    /* 列高自動 */
    gap: 4px;
    /* 格子間距 */
    align-content: start;
    /* 內容靠上對齊 */
}

/* 3. 單一選項方塊 */
.YCIO-export-form .checkbox {
    display: flex;
    align-items: center;
    margin: 0;
    /* 移除預設邊距 */
    padding: 2px 4px;
    background: rgba(255, 255, 255, 0.05);
    /* 給每個選項一點背景，看起來整齊 */
    border-radius: 3px;
    border: 1px solid transparent;
    cursor: pointer;
    overflow: hidden;
    /* 配合文字截斷 */
}

.YCIO-export-form .checkbox:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: #555;
}

/* 4. 選項文字截斷處理 (...) */
.YCIO-export-form .checkbox span {
    margin-left: 4px;
    font-size: 13px;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
    /* 佔滿剩餘寬度 */
}

/* 底部按鈕區 */
.YCIO-export-form .sheet-footer {
    flex-shrink: 0;
    /* 防止按鈕區被壓縮 */
    margin-top: 2px;
}

/* 導出按鈕 */
.YCIO-export-form button[data-action="doExport"] {
    background: #2d4f2d;
    color: #fff;
    border: 1px solid #4a7a4a;
    transition: all 0.2s;
    padding: 4px;
    /* 縮小按鈕高度 */
    font-size: 13px;
}

.YCIO-export-form button[data-action="doExport"]:hover {
    background: #3a633a;
    border-color: #5c9c5c;
    box-shadow: 0 0 5px rgba(0, 255, 0, 0.2);
}

/* =========================================================
   12. 原生聊天介面隱藏 (Native Chat Interface Hiding)
   透過 body class 控制顯示狀態
   ========================================================= */

/* 隱藏側邊欄的「聊天訊息」分頁按鈕 */
body.YCIO-hide-native-ui #sidebar-tabs li:has(button[data-tab="chat"]) {
    display: none !important;
}

/* 隱藏聊天側邊欄的內容區域 */
body.YCIO-hide-native-ui .chat-sidebar {
    display: none !important;
}

/* 隱藏右下談出的訊息與輸入區 */
body.YCIO-hide-native-ui #chat-notifications {
    display: none !important;
}

/* 隱藏彈出式聊天視窗 (Popout) - 防止有人把原生聊天室彈出來 */
body.YCIO-hide-native-ui #chat-popout {
    display: none !important;
}

/* =========================================================
   11. 關於本模組對話框 (About Dialog)
   ========================================================= */

.YCIO-about-dialog {
    display: flex;
    flex-direction: column;
    font-size: 1.1rem;
    /* 增加整體文字大小 */
}

.YCIO-about-dialog .about-header {
    text-align: center;
    border-bottom: 1px solid var(--color-border-dark);
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

.YCIO-about-dialog .about-header h2 {
    margin: 0;
    border: none;
    font-size: 1.8rem;
    /* 放大標題 */
    font-weight: bold;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
}

.YCIO-about-dialog .about-table {
    width: 100%;
    margin-bottom: 0;
    border-collapse: collapse;
    font-size: 1.15rem;
    /* 增加表格內的文字大小 */
}

.YCIO-about-dialog .about-table th {
    text-align: left;
    white-space: nowrap;
    padding: 0.8rem 0.5rem;
    /* 增加行距 */
    width: 30%;
    font-weight: bold;
    color: var(--color-text-light-heading);
}

.YCIO-about-dialog .about-table td {
    padding: 0.8rem 0.5rem;
}

.YCIO-about-dialog .about-table a {
    color: var(--color-text-light-highlight);
    text-decoration: none;
    transition: text-shadow 0.2s, color 0.2s;
}

.YCIO-about-dialog .about-table a:hover {
    color: #fff;
    text-shadow: 0 0 8px var(--color-shadow-highlight);
}

/* 聯絡方式圖示群 */
.YCIO-about-dialog .social-links {
    display: flex;
    gap: 20px;
    /* 增加圖示間距 */
    align-items: center;
    font-size: 2rem;
    /* 大幅放大社群圖示 */
}

/* 獨立出來的贊助按鈕 */
.YCIO-about-dialog .donate-link {
    font-size: 2.2rem;
    /* 讓贊助圖示稍微再大一點 */
    display: flex;
    align-items: center;
}

/* .YCIO-about-dialog .donate-link a { */
/* color: #f96854; */
/* Patreon 品牌色，先註解調保留 */
/* } */

.YCIO-about-dialog .donate-link a:hover {
    color: #ff8877;
    text-shadow: 0 0 10px rgba(249, 104, 84, 0.8);
}